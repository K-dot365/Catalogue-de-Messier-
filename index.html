<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ãƒ¡ã‚·ã‚¨é€²æ—</title>
    <style>
        :root {
            --bg: #0e0f10;
            --panel: #15191e;
            --border: #2b3139;
            --text: #dfe7ef;
            --muted: #8d99a6;
            --btn: #1e242b;
            --btn-hover: #28313a;
            --accent: #4caf50;
            --accent-glow: #b3ffb8;
            --gold: #f4c542;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }

        body {
            margin: 0;
            background: radial-gradient(1000px 600px at 20% -10%, #1b2027, var(--bg));
            color: var(--text);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
            display: grid;
            place-items: center;
            padding: 24px;
        }

        .app { width: min(1100px, 96vw); }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }

        .title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 {
            font-size: clamp(18px, 2.3vw, 24px);
            margin: 0;
            letter-spacing: .02em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .control, button, select {
            background: var(--btn);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px 12px;
            font: inherit;
            transition: transform .02s ease, background .2s ease, border-color .2s ease;
            outline: none;
        }

        button:hover, select:hover { background: var(--btn-hover); }
        button:active { transform: translateY(1px); }

        .progress-btns {
            display: flex;
            gap: 6px;
        }

        .progress-btns button {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: #222;
            border: 1px solid #444;
            color: #aaa;
            font-weight: bold;
            pointer-events: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-btns button.lit {
            background: #0f1419;
            border-color: rgba(76, 175, 80, .7);
            color: #fff;
            box-shadow: 0 0 0 1px rgba(76, 175, 80, .35),
                        0 4px 12px rgba(76, 175, 80, .4),
                        inset 0 0 18px rgba(76, 175, 80, .25);
        }

        .grid {
            background: linear-gradient(180deg, #13171c, var(--panel));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            position: relative;
        }

        .cells { display: grid; gap: 12px; }

        .cell {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            overflow: hidden;
            border-radius: 14px;
        }

        .cell button {
            width: 100%;
            height: 100%;
            background: #0f1419;
            border: 1px solid #212932;
            cursor: pointer;
            position: relative;
            padding: 0;
            overflow: hidden;
        }

        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .cell .badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(27, 34, 42, 0.8);
            border: 1px solid #2a313a;
            color: var(--muted);
            z-index: 2;
        }

        .cell-text {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 6px 4px;
            font-size: clamp(10px, 1.5vw, 12px);
            line-height: 1.2;
            z-index: 2;
        }

        /* ç‚¹ç¯çŠ¶æ…‹ */
        .cell button.lit {
            border-color: rgba(76, 175, 80, .7);
            box-shadow: 0 0 0 1px rgba(76, 175, 80, .7),
                        0 4px 22px 0 rgba(76, 175, 80, .25),
                        inset 0 0 18px rgba(76, 175, 80, .25);
        }

        .cell button.lit img, .cell button.lit .cell-text {
            filter: brightness(1.2) drop-shadow(0 0 5px rgba(76, 255, 80, 0.4));
        }

        /* ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼è¨­å®š */
        .cell button.legendary { border-color: rgba(244, 197, 66, 0.5); }
        .cell button.legendary.lit {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px rgba(244,197,66,.45),
                        0 6px 26px 0 rgba(244,197,66,.35),
                        inset 0 0 22px rgba(244,197,66,.3);
            background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
        }

        /* å ±é…¬ãƒœã‚¿ãƒ³å…±é€š */
        #rewardBtn, #rewardBtnBlue {
            border-radius: 12px;
            font-weight: bold;
            color: #fff;
            transition: all 0.3s ease;
        }

        /* ç·‘/é‡‘ å ±é…¬ãƒœã‚¿ãƒ³ */
        #rewardBtn {
            border: 1px solid var(--accent);
            background: var(--accent);
            box-shadow: 0 0 15px rgba(244,197,66,0.5);
        }
        #rewardBtn:hover:not(:disabled) {
            box-shadow: 0 0 20px var(--accent-glow);
            transform: scale(1.05);
        }

        /* é’ å ±é…¬ãƒœã‚¿ãƒ³ */
        #rewardBtnBlue {
            border: 1px solid #42a5f5;
            background: #42a5f5;
            box-shadow: 0 0 15px rgba(66, 165, 245, 0.7);
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            color: var(--muted);
            font-size: 13px;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
            header { flex-direction: column; align-items: flex-start; }
            .controls { width: 100%; }
        }
    </style>
</head>
<body>

<div class="app">
    <header>
        <div class="title-row">
            <h1>ãƒ¡ã‚·ã‚¨å®Ÿç¸¾è§£é™¤</h1>
            <button id="totalProgressDisplay" class="control" style="pointer-events: none;"></button>
        </div>
        <div class="controls">
            <select id="preset">
                <option value="messier">ãƒ¡ã‚·ã‚¨ä¸€è¦§</option>
                <option value="January">1æœˆç·å†™</option>
                <option value="February">2æœˆç·å†™</option>
                <option value="March">3æœˆç·å†™</option>
                <option value="April">4æœˆç·å†™</option>
                <option value="May">5æœˆç·å†™</option>
                <option value="June">6æœˆç·å†™</option>
                <option value="July">7æœˆç·å†™</option>
                <option value="August">8æœˆç·å†™</option>
                <option value="September">9æœˆç·å†™</option>
                <option value="October">10æœˆç·å†™</option>
                <option value="November">11æœˆç·å†™</option>
                <option value="December">12æœˆç·å†™</option>
            </select>
            
            <button id="rewardBtn" style="display:none;">åŒå®šæ¨©ç²å¾—</button>
            <button id="rewardBtnBlue" style="display:none;">â˜†ãƒ¡ã‚·ã‚¨ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆâ˜†</button>
        </div>
    </header>

    <section class="grid">
        <div id="cells" class="cells"></div>
        <div class="footer">
            <div class="count"><span id="litCount">0</span> / <span id="totalCount">0</span> è§£æ”¾</div>
            <div class="hint">ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯/æ¶ˆç¯</div>
        </div>
    </section>
</div>

<script>
const cellsEl = document.getElementById('cells');
const presetEl = document.getElementById('preset');
const litCountEl = document.getElementById('litCount');
const totalCountEl = document.getElementById('totalCount');

const PRESETS = {
    "messier": {
        size:[17,3],
        labels:[
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M1.jpg",text:"M1 ã‹ã«æ˜Ÿé›²</br>ã€ãŠã†ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M2.jpg",text:"M2 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¿ãšãŒã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M3.jpg",text:"M3 çƒçŠ¶æ˜Ÿå›£</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M4.jpg",text:"M4 çƒçŠ¶æ˜Ÿå›£</br>ã€ã•ãã‚Šåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M5.jpg",text:"M5 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M6.jpg",text:"M6 æ•£é–‹æ˜Ÿå›£</br>ã€ã•ãã‚Šåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M7.jpg",text:"M7 æ•£é–‹æ˜Ÿå›£</br>ã€ã•ãã‚Šåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M8.jpg",text:"M8 å¹²æ½Ÿæ˜Ÿé›²</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M9.jpg",text:"M9 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M10.jpg",text:"M10 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M11.jpg",text:"M11 æ•£é–‹æ˜Ÿå›£</br>ã€ãŸã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M12.jpg",text:"M12 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M13.jpg",text:"M13 çƒçŠ¶æ˜Ÿå›£</br>ã€ãƒ˜ãƒ«ã‚¯ãƒ¬ã‚¹åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M14.jpg",text:"M14 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M15.jpg",text:"M15 çƒçŠ¶æ˜Ÿå›£</br>ã€ãºã‚¬ã‚¹ã‚¹åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M16.jpg",text:"M16 ã‚ã—æ˜Ÿé›²</br>ã€ã¸ã³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M17.jpg",text:"M17 ã‚ªãƒ¡ã‚¬æ˜Ÿé›²</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M18.jpg",text:"M18 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M19.jpg",text:"M19 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M20.jpg",text:"M20 ä¸‰è£‚æ˜Ÿé›²</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M21.jpg",text:"M21 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M22.jpg",text:"M22 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M23.jpg",text:"M23 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M24.jpg",text:"M24 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M25.jpg",text:"M25 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M26.jpg",text:"M26 æ•£é–‹æ˜Ÿå›£</br>ã€ãŸã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M27.jpg",text:"M27 ã‚ã‚Œã„æ˜Ÿé›²</br>ã€ã“ãã¤ã­åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M28.jpg",text:"M28 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M29.jpg",text:"M29 ã¡ã‚‡ã†ã¡ã‚‡(æ•£é–‹)</br>ã€ã¯ãã¡ã‚‡ã†åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M30.jpg",text:"M30 çƒçŠ¶æ˜Ÿå›£</br>ã€ã‚„ãåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M31.jpg",text:"M31 ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€éŠ€æ²³</br>ã€ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M32.jpg",text:"M32 éŠ€æ²³</br>ã€ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M33.jpg",text:"M33 éŠ€æ²³</br>ã€ã•ã‚“ã‹ãåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M34.jpg",text:"M34 æ•£é–‹æ˜Ÿå›£</br>ã€ãƒšãƒ«ã‚»ã‚¦ã‚¹åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M35.jpg",text:"M35 æ•£é–‹æ˜Ÿå›£</br>ã€ãµãŸã”åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M36.jpg",text:"M36 æ•£é–‹æ˜Ÿå›£</br>ã€ãã‚‡ã—ã‚ƒåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M37.jpg",text:"M37 æ•£é–‹æ˜Ÿå›£</br>ã€ãã‚‡ã—ã‚ƒåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M38.jpg",text:"M38 æ•£é–‹æ˜Ÿå›£</br>ã€ãã‚‡ã—ã‚ƒåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M39.jpg",text:"M39 æ•£é–‹æ˜Ÿå›£</br>ã€ã¯ãã¡ã‚‡ã†åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M40.jpg",text:"M40 äºŒé‡æ˜Ÿ(æ¬ ç•ª)</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M41.jpg",text:"M41 æ•£é–‹æ˜Ÿå›£</br>ã€ãŠãŠã„ã¬åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M42.jpg",text:"M42 ã‚ªãƒªã‚ªãƒ³å¤§æ˜Ÿé›²</br>ã€ã‚ªãƒªã‚ªãƒ³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M43.jpg",text:"M43 æ˜Ÿé›²</br>ã€ã‚ªãƒªã‚ªãƒ³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M44.jpg",text:"M44 ãƒ—ãƒ¬ã‚»ãºæ˜Ÿå›£(æ•£é–‹)</br>ã€ã‹ã«åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M45.jpg",text:"M45 ãƒ—ãƒ¬ã‚¢ãƒ‡ã‚¹æ˜Ÿå›£,ã‚¹ãƒãƒ«(æ•£é–‹)</br>ã€ãŠã†ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M46.jpg",text:"M46 æ•£é–‹æ˜Ÿå›£</br>ã€ã¨ã‚‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M47.jpg",text:"M47 æ•£é–‹æ˜Ÿå›£</br>ã€ã¨ã‚‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M48.jpg",text:"M48 æ•£é–‹æ˜Ÿå›£</br>ã€ã†ã¿ã¸ã³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M49.jpg",text:"M49 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M50.jpg",text:"M50 æ•£é–‹æ˜Ÿå›£</br>ã€ã„ã£ã‹ãã˜ã‚…ã†åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M51.jpg",text:"M51 å­æŒã¡éŠ€æ²³</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M52.jpg",text:"M52 æ•£é–‹æ˜Ÿå›£</br>ã€ã‚«ã‚·ã‚ªãƒšãƒ¤åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M53.jpg",text:"M53 çƒçŠ¶æ˜Ÿå›£</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M54.jpg",text:"M54 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M55.jpg",text:"M55 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M56.jpg",text:"M56 çƒçŠ¶æ˜Ÿå›£</br>ã€ã“ã¨åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M57.jpg",text:"M57 ã“ã¨ãƒªãƒ³ã‚°(æ˜Ÿé›²)</br>ã€ã“ã¨åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M58.jpg",text:"M58 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M59.jpg",text:"M59 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M60.jpg",text:"M60 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M61.jpg",text:"M61 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M62.jpg",text:"M62 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M63.jpg",text:"M63 ã²ã¾ã‚ã‚ŠéŠ€æ²³</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M64.jpg",text:"M64 é»’çœ¼éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M65.jpg",text:"M65 éŠ€æ²³</br>ã€ã—ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M66.jpg",text:"M66 éŠ€æ²³</br>ã€ã—ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M67.jpg",text:"M67 æ•£é–‹æ˜Ÿå›£</br>ã€ã‹ã«åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M68.jpg",text:"M68 çƒçŠ¶æ˜Ÿå›£</br>ã€ã†ã¿ã¸ã³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M69.jpg",text:"M69 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M70.jpg",text:"M70 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M71.jpg",text:"M71 çƒçŠ¶æ˜Ÿå›£</br>ã€ã‚„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M72.jpg",text:"M72 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¿ãšãŒã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M73.jpg",text:"M73 æ•£é–‹æ˜Ÿå›£</br>ã€ã¿ãšãŒã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M74.jpg",text:"M74 æ¸¦å·»ãéŠ€æ²³</br>ã€ã†ãŠåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M75.jpg",text:"M75 çƒçŠ¶æ˜Ÿå›£</br>ã€ã„ã¦åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M76.jpg",text:"M76 å°ã‚ã‚Œã„çŠ¶æ˜Ÿé›²</br>ã€ãƒšãƒ«ã‚»ã‚¦ã‚¹åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M77.jpg",text:"M77 éŠ€æ²³</br>ã€ãã˜ã‚‰åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M78.jpg",text:"M78 æ•£å…‰æ˜Ÿé›²</br>ã€ã‚ªãƒªã‚ªãƒ³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M79.jpg",text:"M79 çƒçŠ¶æ˜Ÿå›£</br>ã€ã†ã•ãåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M80.jpg",text:"M80 çƒçŠ¶æ˜Ÿå›£</br>ã€ã•ãã‚Šåº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M81.jpg",text:"M81 æ¸¦å·»ãéŠ€æ²³</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M82.jpg",text:"M82 éŠ€æ²³</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M83.jpg",text:"M83 å—ã®å›è»¢èŠ±ç«éŠ€æ²³</br>ã€ã†ã¿ã¸ã³åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M84.jpg",text:"M84 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M85.jpg",text:"M85 éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M86.jpg",text:"M86 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M87.jpg",text:"M87 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M88.jpg",text:"M88 éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M89.jpg",text:"M89 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M90.jpg",text:"M90 éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M91.jpg",text:"M91 éŠ€æ²³(æ¬ ç•ª)</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M92.jpg",text:"M92 çƒçŠ¶æ˜Ÿå›£</br>ã€ãƒ˜ãƒ«ã‚¯ãƒ¬ã‚¹åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M93.jpg",text:"M93 æ•£é–‹æ˜Ÿå›£</br>ã€ã¨ã‚‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M94.jpg",text:"M94 éŠ€æ²³</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M95.jpg",text:"M95 éŠ€æ²³</br>ã€ã—ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M96.jpg",text:"M96 éŠ€æ²³</br>ã€ã—ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M97.jpg",text:"M97 ãµãã‚ã†æ˜Ÿé›²</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M98.jpg",text:"M98 éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ/M99.jpg",text:"M99 éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M100.jpg",text:"M100 éŠ€æ²³</br>ã€ã‹ã¿ã®ã‘åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M101.jpg",text:"M101 å›è»¢èŠ±ç«éŠ€æ²³</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M102.jpg",text:"M102 éŠ€æ²³(æ¬ ç•ª)</br>ã€ã‚Šã‚…ã†åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M103.jpg",text:"M103 æ•£é–‹æ˜Ÿå›£</br>ã€ã‚«ã‚·ã‚ªãƒšãƒ¤åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M104.jpg",text:"M104 ã‚½ãƒ³ãƒ–ãƒ¬ãƒ­éŠ€æ²³</br>ã€ãŠã¨ã‚åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M105.jpg",text:"M105 éŠ€æ²³</br>ã€ã—ã—åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M106.jpg",text:"M106 æ¸¦å·»ãéŠ€æ²³</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M107.jpg",text:"M107 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¸ã³ã¤ã‹ã„åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M108.jpg",text:"M108 æ¸¦å·»ãéŠ€æ²³</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M109.jpg",text:"M109 æ£’æ¸¦å·»ãéŠ€æ²³</br>ã€ãŠãŠãã¾åº§ã€‘"},
            {img:"ãƒ¡ã‚·ã‚¨å†™çœŸ1/M110.jpg",text:"M110 éŠ€æ²³</br>ã€ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€åº§ã€‘"},
            
            
            
            
            
        ],
        legendary:[48]
    },
    "stargazing-specialist": {
        size:[9,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st001.jpg",text:"æœ›é é¡çµ„ã¿ç«‹ã¦"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st002.jpg",text:"ç·è¦³ã•ã‚“ã‚’å‘¼ã¶"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st003.jpg",text:"ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°é–‹ã"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st004.jpg",text:"åŒå®šä¾é ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st005.jpg",text:"æœ›é é¡ç‰‡ä»˜ã‘"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st006.jpg",text:"M103"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"M110"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st008.jpg",text:"M15"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st009.jpg",text:"M34"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st010.jpg",text:"M33"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st011.jpg",text:"M36"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st012.jpg",text:"M37"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st013.jpg",text:"M38"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"M45"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st015.jpg",text:"M71"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st016.jpg",text:"M2"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st017.jpg",text:"M30"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st018.jpg",text:"M27"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st019.jpg",text:"M29"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st020.jpg",text:"M57"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st021.jpg",text:"M35"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st022.jpg",text:"M42"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st023.jpg",text:"M44"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st024.jpg",text:"M79"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st025.jpg",text:"M41"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st026.jpg",text:"å®Ÿç¸¾é”æˆ"},null
        ],
        legendary:[25]
    },
    "mvp": {
        size:[4,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv001.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å‚åŠ "},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv002.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å„ªå‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv003.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯MVP"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv004.jpg",text:"é‹å‹•å‚åŠ "},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv005.jpg",text:"é‹å‹•å„ªå‹"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•MVP"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv007.jpg",text:"ã‚¯ã‚¤ã‚ºå‚åŠ "},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv008.jpg",text:"ã‚¯ã‚¤ã‚ºå„ªå‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv009.jpg",text:"ã‚¯ã‚¤ã‚ºMVP"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv010.jpg",text:"å®Ÿç¸¾é”æˆ"},null,null
        ],
        legendary:[9]
    },
    "top-adventure-explorer": {
        size:[4,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad002.jpg",text:"å¤§ç¥å±±ç¥ç¤¾"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad003.jpg",text:"ã‚¸ãƒ£ãƒ³ãƒ—å°"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad004.jpg",text:"ã‚²ãƒ¬ãƒ³ãƒ‡"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad005.jpg",text:"ãƒ¢ãƒ³ãƒ™ãƒ«"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad006.jpg",text:"å¤§å±±è‡ªç„¶é¤¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad007.jpg",text:"è¶³æ¹¯"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad008.jpg",text:"ç ‚ä¸˜ã®æµ·"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad009.jpg",text:"é¦¬ã®èƒŒ"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad010.jpg",text:"ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad011.jpg",text:"å®Ÿç¸¾é”æˆ"},null
        ],
        legendary:[10]
    },
    "syaken-A": {
        size:[5,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy001.JPG",text:"ğŸ“¸æ˜Ÿç©º(ä»–)"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy002.jpg",text:"ğŸ“¸å¤©ã®å·"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"ğŸ“¸éŠ€æ²³"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st022.jpg",text:"ğŸ“¸æ˜Ÿé›²"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"ğŸ“¸æ˜Ÿå›£"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy005.jpg",text:"ğŸ“¸å½—æ˜Ÿ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy013.jpg",text:"æ˜¼æŠ•ç¥¨ç”¨"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy006.jpg",text:"å¤œæŠ•ç¥¨ç”¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•ä¼š"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy008.jpg",text:"é£Ÿäº‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy009.jpg",text:"èŠ±ç«"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy010.jpg",text:"éŠã³é¢¨æ™¯"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy013.jpg",text:"æ˜¼1ä½"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy014.jpg",text:"å¤œ1ä½"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st026.jpg",text:"å…¨é”æˆ"},
        ],
        legendary:[12, 13, 14]
    }
};

let currentLabels = [];
let currentLegendary = new Set();

function buildGrid(r, c, labels) {
    cellsEl.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
    cellsEl.innerHTML = '';
    currentLabels = labels;
    let effectiveCount = 0;

    for (let i = 0; i < r * c; i++) {
        const label = labels[i];
        const cell = document.createElement('div');
        cell.className = 'cell';

        if (label) {
            effectiveCount++;
            const btn = document.createElement('button');
            btn.dataset.idx = i;
            if (currentLegendary.has(i)) btn.classList.add('legendary');

            btn.innerHTML = `
                <span class="badge">#${i + 1}</span>
                <img src="${label.img}" onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='">
                <span class="cell-text">${label.text}</span>
            `;

            btn.onclick = () => toggle(btn);
            cell.appendChild(btn);
        }
        cellsEl.appendChild(cell);
    }
    totalCountEl.textContent = effectiveCount;
}

function toggle(btn) {
    const idx = parseInt(btn.dataset.idx);
    const pKey = presetEl.value;

    // è‡ªå‹•ç‚¹ç¯ã‚»ãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ã‚¬ãƒ¼ãƒ‰
    if (pKey === 'syaken-A' && idx === 14) return;
    if (pKey === 'stargazing-specialist' && idx === 25) return;
    if (["tenkenmin", "mvp", "top-adventure-explorer"].includes(pKey)) {
        let lastIdx = PRESETS[pKey].labels.length - 1;
        while (lastIdx >= 0 && PRESETS[pKey].labels[lastIdx] === null) lastIdx--;
        if (idx === lastIdx) return;
    }

    btn.classList.toggle('lit');
    updateCounts();
    save();
}

function updateCounts() {
    const pKey = presetEl.value;
    const allBtns = Array.from(cellsEl.querySelectorAll('button[data-idx]'));

    litCountEl.textContent = cellsEl.querySelectorAll('button.lit').length;
    
    // å ±é…¬ãƒœã‚¿ãƒ³è¡¨ç¤º
    const anyLegendaryLit = cellsEl.querySelector('button.legendary.lit') !== null;
    document.getElementById('rewardBtn').style.display = anyLegendaryLit ? "inline-block" : "none";

    checkProgressButtons();
    updateTotalProgress();
}

function checkProgressButtons() {
    const mapping = {"tenkenmin":"pb1","stargazing-specialist":"pb2","mvp":"pb3","top-adventure-explorer":"pb4","syaken-A":"pb5"};
    Object.entries(PRESETS).forEach(([key, preset]) => {
        const pb = document.getElementById(mapping[key]);
        if (!pb) return;

        let isAchieved = false;
        if (key === presetEl.value) {
            isAchieved = cellsEl.querySelector('button.legendary.lit') !== null;
        } else {
            const data = JSON.parse(localStorage.getItem(`achievements-${key}`) || '{"lit":[]}');
            isAchieved = (preset.legendary || []).some(idx => data.lit.includes(idx));
        }
        pb.classList.toggle('lit', isAchieved);
    });
}

function updateTotalProgress() {
    let totalLit = 0;
    let totalCells = 0;

    Object.entries(PRESETS).forEach(([key, preset]) => {
        const effective = preset.labels.filter(l => l !== null).length;
        totalCells += effective;
        if (key === presetEl.value) {
            totalLit += cellsEl.querySelectorAll('button.lit').length;
        } else {
            const data = JSON.parse(localStorage.getItem(`achievements-${key}`) || '{"lit":[]}');
            totalLit += data.lit.length;
        }
    });

    const percent = (totalLit / totalCells) * 100;
    document.getElementById('totalProgressDisplay').textContent = `${totalLit}/${totalCells} (${percent.toFixed(1)}%)`;
    document.getElementById('rewardBtnBlue').style.display = percent >= 70 ? 'inline-block' : 'none';
}

function save() {
    const lit = Array.from(cellsEl.querySelectorAll('button.lit')).map(b => parseInt(b.dataset.idx));
    localStorage.setItem(`achievements-${presetEl.value}`, JSON.stringify({ lit }));
}

function load(name) {
    const data = JSON.parse(localStorage.getItem(`achievements-${name}`) || '{"lit":[]}');
    cellsEl.querySelectorAll('button').forEach(b => {
        if (data.lit.includes(parseInt(b.dataset.idx))) b.classList.add('lit');
    });
    updateCounts();
}

presetEl.onchange = (e) => {
    const name = e.target.value;
    const p = PRESETS[name];
    currentLegendary = new Set(p.legendary || []);
    buildGrid(p.size[0], p.size[1], p.labels);
    load(name);
    localStorage.setItem('lastPreset', name);
};

window.onload = () => {
    const last = localStorage.getItem('lastPreset') || 'messier';
    presetEl.value = last;
    presetEl.onchange({ target: { value: last } });
};
</script>
</body>
</html>
