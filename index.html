<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ãƒ¡ã‚·ã‚¨é€²æ—</title>
    <style>
        :root {
            --bg: #0e0f10;
            --panel: #15191e;
            --border: #2b3139;
            --text: #dfe7ef;
            --muted: #8d99a6;
            --btn: #1e242b;
            --btn-hover: #28313a;
            --accent: #4caf50;
            --accent-glow: #b3ffb8;
            --gold: #f4c542;
        }

        * { box-sizing: border-box; }
        html, body { height: 100%; }

        body {
            margin: 0;
            background: radial-gradient(1000px 600px at 20% -10%, #1b2027, var(--bg));
            color: var(--text);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
            display: grid;
            place-items: center;
            padding: 24px;
        }

        .app { width: min(1100px, 96vw); }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
            flex-wrap: wrap;
        }

        .title-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 {
            font-size: clamp(18px, 2.3vw, 24px);
            margin: 0;
            letter-spacing: .02em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .control, button, select {
            background: var(--btn);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 8px 12px;
            font: inherit;
            transition: transform .02s ease, background .2s ease, border-color .2s ease;
            outline: none;
        }

        button:hover, select:hover { background: var(--btn-hover); }
        button:active { transform: translateY(1px); }

        .progress-btns {
            display: flex;
            gap: 6px;
        }

        .progress-btns button {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: #222;
            border: 1px solid #444;
            color: #aaa;
            font-weight: bold;
            pointer-events: none;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-btns button.lit {
            background: #0f1419;
            border-color: rgba(76, 175, 80, .7);
            color: #fff;
            box-shadow: 0 0 0 1px rgba(76, 175, 80, .35),
                        0 4px 12px rgba(76, 175, 80, .4),
                        inset 0 0 18px rgba(76, 175, 80, .25);
        }

        .grid {
            background: linear-gradient(180deg, #13171c, var(--panel));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            position: relative;
        }

        .cells { display: grid; gap: 12px; }

        .cell {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            overflow: hidden;
            border-radius: 14px;
        }

        .cell button {
            width: 100%;
            height: 100%;
            background: #0f1419;
            border: 1px solid #212932;
            cursor: pointer;
            position: relative;
            padding: 0;
            overflow: hidden;
        }

        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .cell .badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            background: rgba(27, 34, 42, 0.8);
            border: 1px solid #2a313a;
            color: var(--muted);
            z-index: 2;
        }

        .cell-text {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 6px 4px;
            font-size: clamp(10px, 1.5vw, 12px);
            line-height: 1.2;
            z-index: 2;
        }

        /* ç‚¹ç¯çŠ¶æ…‹ */
        .cell button.lit {
            border-color: rgba(76, 175, 80, .7);
            box-shadow: 0 0 0 1px rgba(76, 175, 80, .7),
                        0 4px 22px 0 rgba(76, 175, 80, .25),
                        inset 0 0 18px rgba(76, 175, 80, .25);
        }

        .cell button.lit img, .cell button.lit .cell-text {
            filter: brightness(1.2) drop-shadow(0 0 5px rgba(76, 255, 80, 0.4));
        }

        /* ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼è¨­å®š */
        .cell button.legendary { border-color: rgba(244, 197, 66, 0.5); }
        .cell button.legendary.lit {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px rgba(244,197,66,.45),
                        0 6px 26px 0 rgba(244,197,66,.35),
                        inset 0 0 22px rgba(244,197,66,.3);
            background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
        }

        /* å ±é…¬ãƒœã‚¿ãƒ³å…±é€š */
        #rewardBtn, #rewardBtnBlue {
            border-radius: 12px;
            font-weight: bold;
            color: #fff;
            transition: all 0.3s ease;
        }

        /* ç·‘/é‡‘ å ±é…¬ãƒœã‚¿ãƒ³ */
        #rewardBtn {
            border: 1px solid var(--accent);
            background: var(--accent);
            box-shadow: 0 0 15px rgba(244,197,66,0.5);
        }
        #rewardBtn:hover:not(:disabled) {
            box-shadow: 0 0 20px var(--accent-glow);
            transform: scale(1.05);
        }

        /* é’ å ±é…¬ãƒœã‚¿ãƒ³ */
        #rewardBtnBlue {
            border: 1px solid #42a5f5;
            background: #42a5f5;
            box-shadow: 0 0 15px rgba(66, 165, 245, 0.7);
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            color: var(--muted);
            font-size: 13px;
        }

        @media (max-width: 600px) {
            body { padding: 12px; }
            header { flex-direction: column; align-items: flex-start; }
            .controls { width: 100%; }
        }
    </style>
</head>
<body>

<div class="app">
    <header>
        <div class="title-row">
            <h1>ãƒ¡ã‚·ã‚¨å®Ÿç¸¾è§£é™¤</h1>
            <button id="totalProgressDisplay" class="control" style="pointer-events: none;"></button>
        </div>
        <div class="controls">
            <select id="preset">
                <option value="messier">ãƒ¡ã‚·ã‚¨ä¸€è¦§</option>
                <option value="January">1æœˆç·å†™</option>
                <option value="February">2æœˆç·å†™</option>
                <option value="March">3æœˆç·å†™</option>
                <option value="April">4æœˆç·å†™</option>
                <option value="May">5æœˆç·å†™</option>
                <option value="June">6æœˆç·å†™</option>
                <option value="July">7æœˆç·å†™</option>
                <option value="August">8æœˆç·å†™</option>
                <option value="September">9æœˆç·å†™</option>
                <option value="October">10æœˆç·å†™</option>
                <option value="November">11æœˆç·å†™</option>
                <option value="December">12æœˆç·å†™</option>
            </select>
            <!-- <div id="progressBtns" class="progress-btns">
                <button id="pb1">1</button>
                <button id="pb2">2</button>
                <button id="pb3">3</button>
                <button id="pb4">4</button>
                <button id="pb5">5</button>
            </div> -->
            <button id="rewardBtn" style="display:none;">åŒå®šæ¨©ç²å¾—</button>
            <button id="rewardBtnBlue" style="display:none;">â˜†ãƒ¡ã‚·ã‚¨ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆâ˜†</button>
        </div>
    </header>

    <section class="grid">
        <div id="cells" class="cells"></div>
        <div class="footer">
            <div class="count"><span id="litCount">0</span> / <span id="totalCount">0</span> è§£æ”¾</div>
            <div class="hint">ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯/æ¶ˆç¯</div>
        </div>
    </section>
</div>

<script>
const cellsEl = document.getElementById('cells');
const presetEl = document.getElementById('preset');
const litCountEl = document.getElementById('litCount');
const totalCountEl = document.getElementById('totalCount');

const PRESETS = {
    "messier": {
        size:[17,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"M1 ã‹ã«æ˜Ÿé›²</br>ã€ãŠã†ã—åº§ã€‘"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex002.jpg",text:"M2 çƒçŠ¶æ˜Ÿå›£</br>ã€ã¿ãšãŒã‚åº§ã€‘"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex003.jpg",text:"M3 çƒçŠ¶æ˜Ÿå›£</br>ã€ã‚Šã‚‡ã†ã‘ã‚“åº§ã€‘"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex004.jpg",text:"M4 çƒçŠ¶æ˜Ÿå›£</br>ã€ã•ãã‚Šåº§ã€‘"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex005.jpg",text:"3.ã¾ã©ã‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex006.jpg",text:"3.ã‚†ã"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex007.jpg",text:"3.ãªã"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex008.jpg",text:"3.ã˜ã‚Š"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex009.jpg",text:"3.ã¤ã‚ˆã½ã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex010.jpg",text:"3.ã¦ã‚‹ã‚„ã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex011.jpg",text:"3.ã‘ã‚ã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex012.jpg",text:"2.ãªã£ã¡ã‚ƒã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex013.jpg",text:"2.ã¯ã‚„ã¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex014.jpg",text:"2.ã¯ã‚‹ãª"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex015.jpg",text:"2.ã‚†ã£ããƒ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex016.jpg",text:"2.ã¨ã‚‚ã, ã‚ˆã“ã‚„ã¾"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex017.jpg",text:"2.ã‚ˆã£ã—ãƒ¼, ã²ã¨ã—"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex018.jpg",text:"1.ãŸã¤ã‚ã"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex019.jpg",text:"1.ã‚ã‚‹ãŒ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex020.jpg",text:"1.ãªãª"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex021.jpg",text:"1.ã²ã¨ã—, ãŠãã‚€ã‚‰"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex022.jpg",text:"1.ãã£ã¡"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex023.jpg",text:"1.ã®ã®"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex024.jpg",text:"1.ãªãª, ãªã£ã¡ã‚ƒã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex025.jpg",text:"1.ã—ã‚‡ã†ã”, ãƒ”ãƒ³ã‚¯"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex026.jpg",text:"1.ã›ã‚Šãª"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex027.jpg",text:"1.ã‚Šã•"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex028.jpg",text:"1.ã‚ã„ã‚Š"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex029.jpg",text:"1.ã‚ãã‚‰"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex030.jpg",text:"1.ã—ã‚“ãŸã‚ã†"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex031.jpg",text:"1.ãã†ã™ã‘"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex032.jpg",text:"1.ã²ã‹ã‚‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex033.jpg",text:"1.ã¿ã²ã‚"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex034.jpg",text:"1.ã‚†ãƒ¼ã„ã¡"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex035.jpg",text:"1.ãµã˜ãƒ¼ãŸ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex036.jpg",text:"1.ã—ã‚…ã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex037.jpg",text:"1.ã‹ã„ã¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex038.jpg",text:"1.ã¡ãƒ¼ã¡ã‚ƒã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex039.jpg",text:"1.ã•ã, ã•ã£ããƒ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex040.jpg",text:"1.ã‘ã‚“ã˜ã‚ã†"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex041.jpg",text:"1.ã•ãã‚‰"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex042.jpg",text:"1.ã„ã£ã•"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex043.jpg",text:"1.ã‚‚ã¨ã, ã‚„ã¾ã—ãŸ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex044.jpg",text:"4.ãŠã‹ã˜ãƒ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex045.jpg",text:"4.OBOGæ§˜"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex046.jpg",text:"4.ãã‚‰"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex047.jpg",text:"4.ãƒã‚¹ã‚¿ãƒ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex048.jpg",text:"4.ã¯ã°ãŸã‚“"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex051.jpg",text:"å…¨å“¡é”æˆ"},
            null,
            null
        ],
        legendary:[48]
    },
    "stargazing-specialist": {
        size:[9,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st001.jpg",text:"æœ›é é¡çµ„ã¿ç«‹ã¦"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st002.jpg",text:"ç·è¦³ã•ã‚“ã‚’å‘¼ã¶"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st003.jpg",text:"ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°é–‹ã"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st004.jpg",text:"åŒå®šä¾é ¼"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st005.jpg",text:"æœ›é é¡ç‰‡ä»˜ã‘"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st006.jpg",text:"M103"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"M110"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st008.jpg",text:"M15"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st009.jpg",text:"M34"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st010.jpg",text:"M33"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st011.jpg",text:"M36"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st012.jpg",text:"M37"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st013.jpg",text:"M38"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"M45"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st015.jpg",text:"M71"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st016.jpg",text:"M2"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st017.jpg",text:"M30"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st018.jpg",text:"M27"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st019.jpg",text:"M29"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st020.jpg",text:"M57"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st021.jpg",text:"M35"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st022.jpg",text:"M42"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st023.jpg",text:"M44"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st024.jpg",text:"M79"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st025.jpg",text:"M41"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st026.jpg",text:"å®Ÿç¸¾é”æˆ"},null
        ],
        legendary:[25]
    },
    "mvp": {
        size:[4,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv001.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å‚åŠ "},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv002.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å„ªå‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv003.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯MVP"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv004.jpg",text:"é‹å‹•å‚åŠ "},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv005.jpg",text:"é‹å‹•å„ªå‹"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•MVP"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv007.jpg",text:"ã‚¯ã‚¤ã‚ºå‚åŠ "},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv008.jpg",text:"ã‚¯ã‚¤ã‚ºå„ªå‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv009.jpg",text:"ã‚¯ã‚¤ã‚ºMVP"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv010.jpg",text:"å®Ÿç¸¾é”æˆ"},null,null
        ],
        legendary:[9]
    },
    "top-adventure-explorer": {
        size:[4,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad002.jpg",text:"å¤§ç¥å±±ç¥ç¤¾"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad003.jpg",text:"ã‚¸ãƒ£ãƒ³ãƒ—å°"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad004.jpg",text:"ã‚²ãƒ¬ãƒ³ãƒ‡"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad005.jpg",text:"ãƒ¢ãƒ³ãƒ™ãƒ«"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad006.jpg",text:"å¤§å±±è‡ªç„¶é¤¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad007.jpg",text:"è¶³æ¹¯"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad008.jpg",text:"ç ‚ä¸˜ã®æµ·"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad009.jpg",text:"é¦¬ã®èƒŒ"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad010.jpg",text:"ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad011.jpg",text:"å®Ÿç¸¾é”æˆ"},null
        ],
        legendary:[10]
    },
    "syaken-A": {
        size:[5,3],
        labels:[
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy001.JPG",text:"ğŸ“¸æ˜Ÿç©º(ä»–)"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy002.jpg",text:"ğŸ“¸å¤©ã®å·"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"ğŸ“¸éŠ€æ²³"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st022.jpg",text:"ğŸ“¸æ˜Ÿé›²"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"ğŸ“¸æ˜Ÿå›£"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy005.jpg",text:"ğŸ“¸å½—æ˜Ÿ"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy013.jpg",text:"æ˜¼æŠ•ç¥¨ç”¨"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy006.jpg",text:"å¤œæŠ•ç¥¨ç”¨"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•ä¼š"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy008.jpg",text:"é£Ÿäº‹"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy009.jpg",text:"èŠ±ç«"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy010.jpg",text:"éŠã³é¢¨æ™¯"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy013.jpg",text:"æ˜¼1ä½"},{img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy014.jpg",text:"å¤œ1ä½"},
            {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st026.jpg",text:"å…¨é”æˆ"},
        ],
        legendary:[12, 13, 14]
    }
};

let currentLabels = [];
let currentLegendary = new Set();

function buildGrid(r, c, labels) {
    cellsEl.style.gridTemplateColumns = `repeat(${c}, 1fr)`;
    cellsEl.innerHTML = '';
    currentLabels = labels;
    let effectiveCount = 0;

    for (let i = 0; i < r * c; i++) {
        const label = labels[i];
        const cell = document.createElement('div');
        cell.className = 'cell';

        if (label) {
            effectiveCount++;
            const btn = document.createElement('button');
            btn.dataset.idx = i;
            if (currentLegendary.has(i)) btn.classList.add('legendary');

            btn.innerHTML = `
                <span class="badge">#${i + 1}</span>
                <img src="${label.img}" onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='">
                <span class="cell-text">${label.text}</span>
            `;

            btn.onclick = () => toggle(btn);
            cell.appendChild(btn);
        }
        cellsEl.appendChild(cell);
    }
    totalCountEl.textContent = effectiveCount;
}

function toggle(btn) {
    const idx = parseInt(btn.dataset.idx);
    const pKey = presetEl.value;

    // è‡ªå‹•ç‚¹ç¯ã‚»ãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ã‚¬ãƒ¼ãƒ‰
    if (pKey === 'syaken-A' && idx === 14) return;
    if (pKey === 'stargazing-specialist' && idx === 25) return;
    if (["tenkenmin", "mvp", "top-adventure-explorer"].includes(pKey)) {
        let lastIdx = PRESETS[pKey].labels.length - 1;
        while (lastIdx >= 0 && PRESETS[pKey].labels[lastIdx] === null) lastIdx--;
        if (idx === lastIdx) return;
    }

    btn.classList.toggle('lit');
    updateCounts();
    save();
}

function updateCounts() {
    const pKey = presetEl.value;
    const allBtns = Array.from(cellsEl.querySelectorAll('button[data-idx]'));
    
    // ç‰¹æ®Šãƒ­ã‚¸ãƒƒã‚¯
    if (["tenkenmin", "top-adventure-explorer"].includes(pKey)) {
        const lastBtn = allBtns[allBtns.length - 1];
        const others = allBtns.slice(0, -1);
        const allLit = others.every(b => b.classList.contains('lit'));
        lastBtn.classList.toggle('lit', allLit);
    }

    if (pKey === "stargazing-specialist") {
        const lastBtn = cellsEl.querySelector('button[data-idx="25"]');
        const first5 = [0,1,2,3,4].every(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit'));
        const nextCount = Array.from({length:20}, (_,i)=>i+5).filter(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')).length;
        if (lastBtn) lastBtn.classList.toggle('lit', first5 && nextCount >= 15);
    }

    if (pKey === "syaken-A") {
        const lastBtn = cellsEl.querySelector('button[data-idx="14"]');
        const others = Array.from({length:12}, (_,i)=>i).every(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit'));
        if (lastBtn) lastBtn.classList.toggle('lit', others);
    }

    if (pKey === "mvp") {
        const lastBtn = allBtns[allBtns.length - 1];
        const p = [0,3,6].every(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit'));
        const c = [1,4,7].some(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit'));
        const m = [2,5,8].some(i => cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit'));
        if (lastBtn) lastBtn.classList.toggle('lit', p && c && m);
    }

    litCountEl.textContent = cellsEl.querySelectorAll('button.lit').length;
    
    // å ±é…¬ãƒœã‚¿ãƒ³è¡¨ç¤º
    const anyLegendaryLit = cellsEl.querySelector('button.legendary.lit') !== null;
    document.getElementById('rewardBtn').style.display = anyLegendaryLit ? "inline-block" : "none";

    checkProgressButtons();
    updateTotalProgress();
}

function checkProgressButtons() {
    const mapping = {"tenkenmin":"pb1","stargazing-specialist":"pb2","mvp":"pb3","top-adventure-explorer":"pb4","syaken-A":"pb5"};
    Object.entries(PRESETS).forEach(([key, preset]) => {
        const pb = document.getElementById(mapping[key]);
        if (!pb) return;

        let isAchieved = false;
        if (key === presetEl.value) {
            isAchieved = cellsEl.querySelector('button.legendary.lit') !== null;
        } else {
            const data = JSON.parse(localStorage.getItem(`achievements-${key}`) || '{"lit":[]}');
            isAchieved = (preset.legendary || []).some(idx => data.lit.includes(idx));
        }
        pb.classList.toggle('lit', isAchieved);
    });
}

function updateTotalProgress() {
    let totalLit = 0;
    let totalCells = 0;

    Object.entries(PRESETS).forEach(([key, preset]) => {
        const effective = preset.labels.filter(l => l !== null).length;
        totalCells += effective;
        if (key === presetEl.value) {
            totalLit += cellsEl.querySelectorAll('button.lit').length;
        } else {
            const data = JSON.parse(localStorage.getItem(`achievements-${key}`) || '{"lit":[]}');
            totalLit += data.lit.length;
        }
    });

    const percent = (totalLit / totalCells) * 100;
    document.getElementById('totalProgressDisplay').textContent = `${totalLit}/${totalCells} (${percent.toFixed(1)}%)`;
    document.getElementById('rewardBtnBlue').style.display = percent >= 70 ? 'inline-block' : 'none';
}

function save() {
    const lit = Array.from(cellsEl.querySelectorAll('button.lit')).map(b => parseInt(b.dataset.idx));
    localStorage.setItem(`achievements-${presetEl.value}`, JSON.stringify({ lit }));
}

function load(name) {
    const data = JSON.parse(localStorage.getItem(`achievements-${name}`) || '{"lit":[]}');
    cellsEl.querySelectorAll('button').forEach(b => {
        if (data.lit.includes(parseInt(b.dataset.idx))) b.classList.add('lit');
    });
    updateCounts();
}

presetEl.onchange = (e) => {
    const name = e.target.value;
    const p = PRESETS[name];
    currentLegendary = new Set(p.legendary || []);
    buildGrid(p.size[0], p.size[1], p.labels);
    load(name);
    localStorage.setItem('lastPreset', name);
};

window.onload = () => {
    const last = localStorage.getItem('lastPreset') || 'tenkenmin';
    presetEl.value = last;
    presetEl.onchange({ target: { value: last } });
};
</script>
</body>
</html>
